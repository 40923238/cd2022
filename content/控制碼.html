<!DOCTYPE html><html>
        <head>
        <title>cmsimde_site</title>
        <meta charset="utf-8">
<meta property="head" content="H2">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700,900" rel="stylesheet">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/icomoon/style.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/magnific-popup.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/jquery-ui.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.carousel.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/aos.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/style.css">
        <link rel="shortcut icon" href="./../cmsimde/static/favicons.png">
        
        <style type='text/css'>
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body > div > div.dropdown.open {
                display: block;
            }
        </style>
    
        <!-- <script src="./../cmsimde/static/jquery.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/normalize.min.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch_set.js"></script>
        <script src="tipuesearch_content.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/tipuesearch.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch.js"></script>
        <!-- for Wink3 -->
        <link rel="stylesheet" type="text/css" href="./../cmsimde/static/winkPlayer.css" />
        <script type="text/javascript" src="./../cmsimde/static/winkPlayer.js"></script>
        <script>
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        </script>
        
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushHaxe.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPowerShell.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDart.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushRust.js"></script>
<link type="text/css" rel="stylesheet" href="./../cmsimde/static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 暫時不用
<script src="./../cmsimde/static/fengari-web.js"></script>
<script type="text/javascript" src="./../cmsimde/static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.add_border {
    border: 3px solid blue;
}
</style>

</head>
<body>
<div class='container-fluid'><nav>
        
    <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
    
            <header class="site-navbar py-4 bg-white" role="banner">
              <div class="container-fluid">
                <div class="row align-items-center">
                <h1>40923238cmsimde_site</h1>
                <div class="pl-4">
                    <form>
                    <input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required>
                    </form>
                </div>
                  <!-- <div class="col-11 col-xl-2">
                    <h1 class="mb-0 site-logo"><a href="index.html" class="text-black h2 mb-0">40923238cmsimde_site</a></h1> 
                  </div>
                  -->
                  <div class="col-12 col-md-10 d-none d-xl-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">
    <ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'>
                        <li class="active has-children"><a href="index.html">Home</a>
                        <ul class="dropdown">
                            <li><a href="sitemap.html">Site Map</a></li>
                            <li><a href="./../reveal/index.html">reveal</a></li>
                            <li><a href="./../blog/index.html">blog</a></li>
                        </ul>
                      </li>
                     <li><a href='About.html'>About</a><li><a href='全班網頁.html'>全班網頁</a><li class='has-children'><a href='HomeWork.html'>HomeWork</a><ul class='dropdown'><li><a href='W3.html'>W3</a><li><a href='W6.html'>W6</a><li><a href='W7.html'>W7</a><li class='has-children'><a href='W10.html'>W10</a><ul class='dropdown'><li><a href='w10_block_ui.html'>w10_block_ui</a></li></li></ul></ul><li class='has-children'><a href='online.html'>online</a><ul class='dropdown'><li><a href='STL.html'>STL</a><li><a href='控制碼.html'>控制碼</a><li><a href='XML.html'>XML</a><li><a href='分析.html'>分析</a></li></ul><li><a href='W15.html'>W15</a><li><a href='W16.html'>W16</a><li><a href='期末考週.html'>期末考週</a></li>
                      </ul>
                </nav>
              </div>
              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>
              </div>

            </div>
          </div>
          
        </header>
    <div id="tipue_search_content">STL << <a href='STL.html'>Previous</a> <a href='XML.html'>Next</a> >> XML<br /><h1>控制碼</h1>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">function sysCall_init()
    -- Check if the required plugin (simExtMTB.dll) is there:
    moduleName=0
    moduleVersion=0
    index=0
    MTBModuleFound=false
    while moduleName do
        moduleName,moduleVersion=sim.getModuleName(index)
        if (moduleName=='MTB') then
            MTBModuleFound=true
        end
        index=index+1
    end
    if (MTBModuleFound==false) then
        sim.addLog(sim.verbosity_scripterrors,'\'MTB\' plugin was not found. (simExtMTB.dll, libsimExtMTB.dylib or libsimExtMTB.so). Simulation will not run properly')
    end
    -- Get some object handles that are required later:
    robotHandle=sim.getObject('.')
    jointHandles={-1,-1,-1,-1}
    for i=1,4,1 do
        jointHandles[i]=sim.getObject('./axis',{index=i-1})
    end
    robotName=sim.getObjectAlias(sim.getObject('.'),1)
    collisionMessageID=-1
    compilErrorMessageID=-1
    dfltButProp=sim.buttonproperty_button+sim.buttonproperty_horizontallycentered+sim.buttonproperty_staydown+sim.buttonproperty_verticallycentered
    jointPositions={0,0,0,0}
    for i=1,4,1 do
        jointPositions[i]=sim.getJointPosition(jointHandles[i]) -- the initial joint positions
    end
    restarting=false
    cmdMessage=''
    robotProgramExecutionState=1 -- 0 is stopped, 1 is executing, 2 is paused
    -- Now start the server:
    serverHandle=startRobotServer(robotHandle,program,{0,0,0,0},{0.1,0.4})
end

program=[[REM ************************************************
REM This is a very very simple robot language EXAMPLE!
REM Following commands are supported (one command per line):
REM -"REM" starts a comment line
REM -"SETROTVEL v": sets the revolute joint velocity for next movements (in degrees/s)
REM -"SETLINVEL v": sets the prismatic joint velocity for next movements (in meters/s)
REM -"MOVE p1 p2 p3 p4": moves to joint positions (p1;p2;p3;p4) (in degrees or meter)
REM -"WAIT x": waits x miliseconds
REM -"SETBIT y": sets the bit at pos y in the output buffer
REM -"CLEARBIT y": clears the bit at pos y in the output buffer
REM -"IFBITGOTO y label": jumps to "label" position if bit at pos y is set in the input buffer
REM -"IFNBITGOTO y label": jumps to "label" position if bit at pos y is not set in the input buffer
REM -"GOTO label": jumps to "label" position
REM any not recognized word is considered to be a label
REM ************************************************
SETROTVEL 45
SETLINVEL 0.1
MOVE 0 0 0 0
PROGRAM_BEGIN_LABEL
MOVE 0 0 0.03 0
IFBITGOTO 1 LABEL1
SETBIT 1
LABEL1
WAIT 500
MOVE 0 0 0 0
WAIT 250
MOVE -160 -43.5 0 203.5
WAIT 250
MOVE -160 -43.5 0.03 203.5
CLEARBIT 1
WAIT 500
MOVE -160 -43.5 0 203.5
WAIT 250
MOVE 160 43.5 0 -203.5
WAIT 250
MOVE 160 43.5  0.03 -203.5
IFBITGOTO 1 LABEL2
SETBIT 1
LABEL2
WAIT 500
MOVE 160 43.5  0 -203.5
GOTO LABEL1
]]

-- ***********************************************************************************************************************
-- ***********************************************************************************************************************
-- ***********************************************************************************************************************
-- This script makes the link between the MTB robot and the simExtMtb.dll plugin. This script could be much
-- shorter and simple, if everything was taken care of in the plugin. The advantage of handling many things here
-- is that if something needs to be changed, the plugin doesn't require to be recompiled
-- Following commands are registered by the MTB plugin:
--
-- number serverHandle,string msg=simMTB.startServer(string serverExecutable,number connectionPort,string programData,table_4 jointValues,table_2 initialJointVelocity)
-- Starts a robot server, and compiles the program. If result&gt;=0, the call was successful. Otherwise msg contains a compilation error message
--
-- boolean result=simMTB.stopServer(number serverHandle)
-- Stops a robot server
--
-- number result,string info=simMTB.step(number serverHandle,number deltaTime)
-- runs the robot language interpreter for deltaTime. if result==0, the program is running, if result==1 the program ended. Any other value means an error
--
-- table_4 jointValues=simMTB.getJoints(number serverHandle)
-- returns the values of the robot's 4 axis
--
-- table_4 outputValues=simMTB.getOutput(number serverHandle)
-- returns the 32 bits (4*8) of the robot's outputs
--
-- table_4 inputValues=simMTB.getInput(number serverHandle)
-- returns the 32 bits (4*8) of the robot's inputs
--
-- number result=simMTB.setInput(number serverHandle,table_4 inputValues)
-- writes the 32 bits (4*8) of the robot's inputs
--
-- boolean result=simMTB.connectInput(number inputServerHandle,number inputBitNumber,number outputServerHandle,number outputBitNumber,number connectionType)
-- connects a robot's output bit to another robot's input bit. If connectionType~=0 the connection line invertes the bit state
--
-- boolean result=simMTB.disconnectInput(number inputServerHandle,number inputBitNumber)
-- disconnects a connection previously done with simMTB.connectInput
--
-- ***********************************************************************************************************************
-- ***********************************************************************************************************************
-- ***********************************************************************************************************************

function displayUiIfNeeded()
    local objs=sim.getObjectSelection()
    if objs~=nil and objs[#objs]==robotHandle then
        createUi()
    else
        removeUi()
    end
end

function createUi()
    if ui==nil then
        local xml = '&lt;ui title="'..sim.getObjectAlias(robotHandle,1)..'" closeable="false" resizeable="false" activate="false" placement="relative" position="-50,50"&gt;'..[[
            &lt;tabs&gt;
                &lt;tab title="Command"&gt;
                    &lt;group layout="hbox" flat="true"&gt;
                        &lt;button text="Start/Restart" on-click="start_callback" id="1"/&gt;
                        &lt;button text="Pause" on-click="pause_callback" id="2"/&gt;
                        &lt;button text="Stop" on-click="stop_callback" id="3"/&gt;
                    &lt;/group&gt;
                    &lt;group layout="form" flat="true"&gt;
                        &lt;label text="Command" /&gt;
                        &lt;edit id="4" enabled="false"/&gt;
                    &lt;/group&gt;
                &lt;/tab&gt;
                &lt;tab title="Joints"&gt;
                    &lt;group layout="form" flat="true"&gt;
                        &lt;label text="Joint 1" /&gt;
                        &lt;edit id="11" enabled="false"/&gt;
                        &lt;label text="Joint 2" /&gt;
                        &lt;edit id="12" enabled="false"/&gt;
                        &lt;label text="Joint 3" /&gt;
                        &lt;edit id="13" enabled="false"/&gt;
                        &lt;label text="Joint 4" /&gt;
                        &lt;edit id="14" enabled="false"/&gt;
                    &lt;/group&gt;
                &lt;/tab&gt;
                &lt;tab title="Input"&gt;
                    &lt;group layout="grid" flat="true"&gt;
                    &lt;label text="" /&gt;
                    &lt;label text="1" /&gt;
                    &lt;label text="2" /&gt;
                    &lt;label text="3" /&gt;
                    &lt;label text="4" /&gt;
                    &lt;label text="5" /&gt;
                    &lt;label text="6" /&gt;
                    &lt;label text="7" /&gt;
                    &lt;label text="8" /&gt;
                    &lt;br/&gt;
                    &lt;label text="+00" /&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="101"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="102"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="103"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="104"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="105"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="106"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="107"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="108"/&gt;
                    &lt;br/&gt;
                    &lt;label text="+08" /&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="109"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="110"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="111"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="112"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="113"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="114"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="115"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="116"/&gt;
                    &lt;br/&gt;
                    &lt;label text="+16" /&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="117"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="118"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="119"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="120"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="121"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="122"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="123"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="124"/&gt;
                    &lt;br/&gt;
                    &lt;label text="+24" /&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="125"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="126"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="127"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="128"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="129"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="130"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="131"/&gt;
                    &lt;checkbox text="" on-change="inputClicked_callback" id="132"/&gt;
                    &lt;/group&gt;
                &lt;/tab&gt;
                &lt;tab title="Output"&gt;
                    &lt;group layout="grid" flat="true"&gt;
                    &lt;label text="" /&gt;
                    &lt;label text="1" /&gt;
                    &lt;label text="2" /&gt;
                    &lt;label text="3" /&gt;
                    &lt;label text="4" /&gt;
                    &lt;label text="5" /&gt;
                    &lt;label text="6" /&gt;
                    &lt;label text="7" /&gt;
                    &lt;label text="8" /&gt;
                    &lt;br/&gt;
                    &lt;label text="+00" /&gt;
                    &lt;checkbox text="" enabled="false" id="201"/&gt;
                    &lt;checkbox text="" enabled="false" id="202"/&gt;
                    &lt;checkbox text="" enabled="false" id="203"/&gt;
                    &lt;checkbox text="" enabled="false" id="204"/&gt;
                    &lt;checkbox text="" enabled="false" id="205"/&gt;
                    &lt;checkbox text="" enabled="false" id="206"/&gt;
                    &lt;checkbox text="" enabled="false" id="207"/&gt;
                    &lt;checkbox text="" enabled="false" id="208"/&gt;
                    &lt;br/&gt;
                    &lt;label text="+08" /&gt;
                    &lt;checkbox text="" enabled="false" id="209"/&gt;
                    &lt;checkbox text="" enabled="false" id="210"/&gt;
                    &lt;checkbox text="" enabled="false" id="211"/&gt;
                    &lt;checkbox text="" enabled="false" id="212"/&gt;
                    &lt;checkbox text="" enabled="false" id="213"/&gt;
                    &lt;checkbox text="" enabled="false" id="214"/&gt;
                    &lt;checkbox text="" enabled="false" id="215"/&gt;
                    &lt;checkbox text="" enabled="false" id="216"/&gt;
                    &lt;br/&gt;
                    &lt;label text="+16" /&gt;
                    &lt;checkbox text="" enabled="false" id="217"/&gt;
                    &lt;checkbox text="" enabled="false" id="218"/&gt;
                    &lt;checkbox text="" enabled="false" id="219"/&gt;
                    &lt;checkbox text="" enabled="false" id="220"/&gt;
                    &lt;checkbox text="" enabled="false" id="221"/&gt;
                    &lt;checkbox text="" enabled="false" id="222"/&gt;
                    &lt;checkbox text="" enabled="false" id="223"/&gt;
                    &lt;checkbox text="" enabled="false" id="224"/&gt;
                    &lt;br/&gt;
                    &lt;label text="+24" /&gt;
                    &lt;checkbox text="" enabled="false" id="225"/&gt;
                    &lt;checkbox text="" enabled="false" id="226"/&gt;
                    &lt;checkbox text="" enabled="false" id="227"/&gt;
                    &lt;checkbox text="" enabled="false" id="228"/&gt;
                    &lt;checkbox text="" enabled="false" id="229"/&gt;
                    &lt;checkbox text="" enabled="false" id="230"/&gt;
                    &lt;checkbox text="" enabled="false" id="231"/&gt;
                    &lt;checkbox text="" enabled="false" id="232"/&gt;
                    &lt;/group&gt;
                &lt;/tab&gt;
            &lt;/tabs&gt;
            &lt;/ui&gt;
            ]]
        ui=simUI.create(xml)
    end
end

function removeUi()
    if ui then
        simUI.destroy(ui)
        ui=nil
    end
end

function updateUiIfNeeded()
    if ui then
        -- Update the main custom dialog:
        -- The "run" button:
        simUI.setEnabled(ui,1,robotProgramExecutionState~=1)
        -- The "pause" button:
        simUI.setEnabled(ui,2,robotProgramExecutionState==1)
        -- The "stop" button:
        simUI.setEnabled(ui,3,robotProgramExecutionState~=0)
        -- The command label:
        simUI.setEditValue(ui,4,cmdMessage)
        -- The joint labels:
        simUI.setEditValue(ui,11,string.format('%.2f',jointPositions[1]*180/math.pi))
        simUI.setEditValue(ui,12,string.format('%.2f',jointPositions[2]*180/math.pi))
        simUI.setEditValue(ui,13,string.format('%.4f',jointPositions[3]))
        simUI.setEditValue(ui,14,string.format('%.2f',jointPositions[4]*180/math.pi))
        
        -- Update (read and write) the IN/OUT custom dialog:
        if MTBModuleFound then
            for i=0,3,1 do
                for j=0,7,1 do
                    if ((inputData[1+i]&amp;(2^j))~=0) then
                        simUI.setCheckboxValue(ui,101+j+i*8,2)
                    else
                        simUI.setCheckboxValue(ui,101+j+i*8,0)
                    end
                    if ((outputData[1+i]&amp;(2^j))~=0) then
                        simUI.setCheckboxValue(ui,201+j+i*8,2)
                    else
                        simUI.setCheckboxValue(ui,201+j+i*8,0)
                    end
                end
            end
        end
    end
end

startRobotServer=function(theRobotHandle,theProgram,initJoints,initVel)
    -- Find a (hopefully) free port:
    local portNb=sim.getInt32Param(sim.intparam_server_port_next)
    local portStart=sim.getInt32Param(sim.intparam_server_port_start)
    local portRange=sim.getInt32Param(sim.intparam_server_port_range)
    local newPortNb=portNb+1
    if (newPortNb&gt;=portStart+portRange) then
        newPortNb=portStart
    end
    sim.setInt32Param(sim.intparam_server_port_next,newPortNb)
    -- Start the server:
    local serverHandle,errorMsg=simMTB.startServer('mtbServer',portNb,theProgram,initJoints,initVel)
    if serverHandle&lt;0 then
        -- We have a problem. Display the message:
        sim.addLog(sim.verbosity_scripterrors,'Robot \''..robotName..'\' caused a program compilation error: '..errorMsg)
    end
    -- Now write the server handle to the robot object, so that other objects can access that handle too:
    sim.writeCustomDataBlock(theRobotHandle,'@tmpMTBSERVERHANDLE',sim.packInt32Table({serverHandle}))
    return serverHandle
end

function start_callback()
    -- "Run" was pressed
    if (robotProgramExecutionState==0) then
        robotProgramExecutionState=1
    else
        if (robotProgramExecutionState==2) then robotProgramExecutionState=1 end
    end
end

function pause_callback()
    -- "Pause" was pressed
    if (robotProgramExecutionState==1) then robotProgramExecutionState=2 end
end

function stop_callback()
    -- "Stop" was pressed
    if (robotProgramExecutionState~=0) then
        robotProgramExecutionState=0
        restarting=true
        cmdMessage=''
    end
end

function inputClicked_callback(ui,id,newVal)
    inputData[1+math.floor((id-101)/8)]=(inputData[1+math.floor((id-101)/8)]~(2^math.mod(id-101,8)))
    simMTB.setInput(serverHandle,inputData)
end


function sysCall_cleanup()
    sim.writeCustomDataBlock(robotHandle,'@tmpMTBSERVERHANDLE',nil)
    if serverHandle&gt;=0 then
        simMTB.stopServer(serverHandle)
    end
    removeUi()
end 

function sysCall_actuation()
    displayUiIfNeeded()
    -- Following section is where the script is communicating with the extension module:
    -- #################################################################################
    if MTBModuleFound and serverHandle&gt;=0 then
        if (robotProgramExecutionState&gt;0) then
            dt=sim.getSimulationTimeStep()
            if (robotProgramExecutionState==2) then dt=0 end -- When pausing, we simply set dt to zero!
    
            if (restarting) then
                -- Reset the robot and interpreter:
                simMTB.stopServer(serverHandle)
                serverHandle=startRobotServer(robotHandle,program,{0,0,0,0},{0.1,0.4})
                restarting=false
            else
                -- Handle the robot program (simMTB.run is a custom Lua command defined in the simExtMtb.dll extension module):
                result,cmdMessage,newJointPositions=simMTB.step(serverHandle,dt)
                if (result~=-1) then
                    -- program executes fine
                    -- Read the joint values and the robot's output (simMTB.getJoints and simMTB.getOutput are custom Lua command defined in the simExtMtb.dll extension module):
                    jointPositions=simMTB.getJoints(serverHandle)
                    outputData=simMTB.getOutput(serverHandle)
                    if (result==1) then
                        -- program end
                        robotProgramExecutionState=0
                        restarting=true
                        cmdMessage=''
                    end
                end
            end
        end
    
        -- Read the robot's input (simMTB.getInput is a custom Lua command defined in the simExtMtb.dll extension module):
        inputData=simMTB.getInput(serverHandle)
    end
    -- ---------------------------------------------------------------------------------
    
    -- Report the new joint positions to the MTB robot:
    for i=1,4,1 do
        sim.setJointPosition(jointHandles[i],jointPositions[i])
    end
    
    updateUiIfNeeded()
end 
</pre>
<p></p>
<br />STL << <a href='STL.html'>Previous</a> <a href='XML.html'>Next</a> >> XML</div>
        
    <!-- footer -->
      <div class="container">
        <div class="row pt-3 mx-auto">
            <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
        </div>
      </div>
    <!-- for footer -->
    
        </div> <!-- for site wrap -->
            <!-- <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script> -->
            <script src="../cmsimde/static/chimper/js/jquery-migrate-3.0.1.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery-ui.js"></script>
            <script src="../cmsimde/static/chimper/js/popper.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap.min.js"></script>
            <script src="../cmsimde/static/chimper/js/owl.carousel.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.stellar.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.countdown.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.magnific-popup.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap-datepicker.min.js"></script>
            <script src="../cmsimde/static/chimper/js/aos.js"></script>
            <!--
            <script src="../cmsimde/static/chimper/js/typed.js"></script>
                    <script>
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    </script>
            -->
            <script src="../cmsimde/static/chimper/js/main.js"></script>
        
<!-- 啟用 LaTeX equations 編輯 -->
  <!-- <script>
  MathJax = {
    tex: {inlineMath: [['$', '$'], ['\(', '\)']]}
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>-->
    </body></html>
        